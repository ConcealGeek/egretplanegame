var __reflect=this&&this.__reflect||function(t,e,r){t.__class__=e,r?r.push(e):r=[e],t.__types__=t.__types__?r.concat(t.__types__):r},__extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);r.prototype=e.prototype,t.prototype=new r},__awaiter=this&&this.__awaiter||function(t,e,r,i){return new(r||(r=Promise))(function(n,a){function o(t){try{h(i.next(t))}catch(e){a(e)}}function s(t){try{h(i["throw"](t))}catch(e){a(e)}}function h(t){t.done?n(t.value):new r(function(e){e(t.value)}).then(o,s)}h((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function r(t){return function(e){return i([t,e])}}function i(r){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,a&&(o=a[2&r[0]?"return":r[0]?"throw":"next"])&&!(o=o.call(a,r[1])).done)return o;switch(a=0,o&&(r=[0,o.value]),r[0]){case 0:case 1:o=r;break;case 4:return h.label++,{value:r[1],done:!1};case 5:h.label++,a=r[1],r=[0];continue;case 7:r=h.ops.pop(),h.trys.pop();continue;default:if(o=h.trys,!(o=o.length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){h=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){h.label=r[1];break}if(6===r[0]&&h.label<o[1]){h.label=o[1],o=r;break}if(o&&h.label<o[2]){h.label=o[2],h.ops.push(r);break}o[2]&&h.ops.pop(),h.trys.pop();continue}r=e.call(t,h)}catch(i){r=[6,i],a=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var n,a,o,s,h={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},myRectangle=function(){function t(t,e,r,i){this.x=t,this.y=e,this.width=r,this.height=i}return t}();__reflect(myRectangle.prototype,"myRectangle");var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return r.sent(),[4,this.loadTheme()];case 2:return r.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return r.sent(),this.stage.removeChild(t),[3,5];case 4:return e=r.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,r){var i=new eui.Theme("resource/default.thm.json",t.stage);i.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){this.addChild(new StartUI)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var Bullet=function(t){function e(){var e=t.call(this)||this;return e.source=RES.getRes("aircraftBullet_png"),e.width=GameVar.bulletWidth,e.height=GameVar.bulletHeight,e.anchorOffsetX=0,e.anchorOffsetY=0,e}return __extends(e,t),e}(eui.Image);__reflect(Bullet.prototype,"Bullet");var FruitType;!function(t){t[t.None=0]="None",t[t.Fruit1=1]="Fruit1",t[t.Fruit2=2]="Fruit2",t[t.Fruit3=3]="Fruit3"}(FruitType||(FruitType={}));var Fruit=function(t){function e(e){var r=t.call(this)||this;return r.fruitType=e,r}return __extends(e,t),Object.defineProperty(e.prototype,"fruitType",{get:function(){return this._fruitType},set:function(t){this._fruitType=t,this.source=RES.getRes("fruit_"+t+"_png"),this.width=GameVar.FruitWidth[t],this.speed=GameVar.FruitDownSpeed[t],this.hp=GameVar.FruitHP[t],this.score=GameVar.FruitScore[t],this.isRectangle=GameVar.FruitRectangle[t],this.rectangleArea=GameVar.FruitRectangleArray[t]},enumerable:!0,configurable:!0}),e}(eui.Image);__reflect(Fruit.prototype,"Fruit");var Game=function(t){function e(){var e=t.call(this)||this;return e.bullets=[],e.bulletlasttime=0,e.bulletbirthtime=0,e.lasttime=0,e.birthtime=0,e.skinName="resource/skins/GameSkin.exml",e}return __extends(e,t),e.getInstance=function(){return null==this._instance&&(this._instance=new e),this._instance},Object.defineProperty(e.prototype,"gameScore",{get:function(){return this._gameScore},set:function(t){this._gameScore=t,this.lb_score.text=this.lb_overscore.text=t.toString()},enumerable:!0,configurable:!0}),e.prototype.restart=function(){this.lasttime=0,this.birthtime=0,this.bulletlasttime=0,this.bulletbirthtime=0,this.com_aircreft.x=295,this.com_aircreft.y=1127.52,this.gp_fruit.removeChildren(),this.removeChild(this.gp_gameover),this.com_aircreft.fire(),this.com_aircreft.moveAir(),this.com_aircreft.addEventListener("createBullet",this.createBulletHandler,this),egret.startTick(this.onUpdate,this);var t=RES.getRes("boom_json"),e=RES.getRes("boom_png");this.boomFactory=new egret.MovieClipDataFactory(t,e),this.gameScore=0},e.prototype.back=function(){this.parent.addChild(StartUI.getInstance()),this.parent.removeChild(this)},e.prototype.gameOver=function(){this.addChild(this.gp_gameover),this.btn_restart.addEventListener(egret.TouchEvent.TOUCH_TAP,this.restart,this),this.btn_mainmenu.addEventListener(egret.TouchEvent.TOUCH_TAP,this.back,this),this.com_aircreft.stopFire(),this.com_aircreft.stopMoveAir(),this.com_aircreft.removeEventListener("createBullet",this.createBulletHandler,this),egret.stopTick(this.onUpdate,this);for(var t=0;t<this.gp_gameover.numChildren;t++){var e=this.gp_gameover.getChildAt(t);e.alpha=0,egret.Tween.get(e).wait(200*t).to({alpha:1},500)}},e.prototype.createBulletHandler=function(t){var e=egret.getTimer(),r=e-this.bulletlasttime;if(this.bulletlasttime=e,this.bulletbirthtime+=r,this.bulletbirthtime>GameVar.BulletBirthSpeed){this.bulletbirthtime=0;var i=new Bullet;i.x=this.com_aircreft.x+this.com_aircreft.width/2-i.width/2,i.y=this.com_aircreft.y-i.height,this.addChild(i),this.bullets.push(i)}},e.prototype.onUpdate=function(t){var e=this,r=t-this.lasttime;if(0==this.lasttime)return this.lasttime=t,!1;this.lasttime=t,this.birthtime+=r;for(var i=this.bullets.length-1;i>=0;i--){var n=this.bullets[i];n.y-=r*GameVar.BulletSpeed,n.y<0&&(this.removeChild(n),this.bullets.splice(i,1))}if(this.birthtime>GameVar.FruitBirthSpeed){this.birthtime=0;var a=new Fruit(Math.floor(3*Math.random()+1));a.x=Math.random()*(this.gp_fruit.width-this.com_aircreft.width)+this.com_aircreft.width/2-a.width/2,this.gp_fruit.addChild(a)}for(var i=this.gp_fruit.numChildren-1;i>=0;i--){var o=this.gp_fruit.getChildAt(i);if(o.y+=r*o.speed*(Math.random()+1),GameUtil.hitTestFruitAir(o,this.com_aircreft))return this.gameOver(),!1;o.y>this.gp_fruit.height&&this.gp_fruit.removeChild(o)}for(var s=this.bullets.length-1;s>=0;s--)for(var o,n=this.bullets[s],h=function(t){if(o=u.gp_fruit.getChildAt(t),GameUtil.hitTestFruitObj(o,n)){if(u.removeChild(n),u.bullets.splice(s,1),o.hp--,0==o.hp){u.gameScore+=o.score;var r=new egret.MovieClip(u.boomFactory.generateMovieClipData("boom"));r.x=o.x+o.width/2,r.y=o.y+o.height/2,u.addChild(r),r.gotoAndPlay(0,1),r.addEventListener(egret.Event.COMPLETE,function(t){e.removeChild(r),r=null},u),u.gp_fruit.removeChild(o)}return"break"}},u=this,i=this.gp_fruit.numChildren-1;i>=0;i--){var c=h(i);if("break"===c)break}return this.gp_fruit_bg.anchorOffsetY-=r*GameVar.BgDownSpeed,this.gp_fruit_bg.anchorOffsetY<=-1125&&(this.gp_fruit_bg.anchorOffsetY=0),!1},e._instance=null,e}(eui.Component);__reflect(Game.prototype,"Game");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=667,this.textField.width=750,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,r){function i(i){e.call(r,i,t)}if(RES.hasRes(t)){var n=RES.getRes(t);n?i(n):RES.getResAsync(t,i,this)}else RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Aircraft=function(t){function e(){var e=t.call(this)||this;return e._touchStatus=!1,e._distance=new egret.Point,e.fireDelay=GameVar.FireDelay,e.fireTimer=new egret.Timer(e.fireDelay),e.fireTimer.addEventListener(egret.TimerEvent.TIMER,e.createBullet,e),e}return __extends(e,t),e.prototype.fire=function(){this.fireTimer.start()},e.prototype.stopFire=function(){this.fireTimer.stop()},e.prototype.moveAir=function(){console.log(this.hasEventListener(egret.TouchEvent.TOUCH_BEGIN)),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouseDown,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.mouseUp,this)},e.prototype.stopMoveAir=function(){console.log(this.hasEventListener(egret.TouchEvent.TOUCH_BEGIN)),this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouseDown,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.mouseUp,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)},e.prototype.createBullet=function(t){this.dispatchEventWith("createBullet")},e.prototype.mouseDown=function(t){this._touchStatus=!0,this._distance.x=t.stageX-this.x,this._distance.y=t.stageY-this.y,this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)},e.prototype.mouseMove=function(t){this._touchStatus&&(this.x=Math.min(Math.max(0,t.stageX-this._distance.x),GameVar.stageWidth-this.width),this.y=Math.min(Math.max(0,t.stageY-this._distance.y),GameVar.stageHeight-this.height))},e.prototype.mouseUp=function(t){this._touchStatus=!1,this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)},e}(eui.Component);__reflect(Aircraft.prototype,"Aircraft");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var StartUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="resource/skins/StartSkin.exml",e.btn_play.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onclick_play,e),e}return __extends(e,t),e.getInstance=function(){return null==e._instance&&(e._instance=new e),e._instance},e.prototype.onclick_play=function(){this.parent.addChild(Game.getInstance()),this.parent.removeChild(this),Game.getInstance().restart()},e._instance=null,e}(eui.Component);__reflect(StartUI.prototype,"StartUI");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,r,i){function n(t){e.call(i,t)}function a(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),r.call(i))}"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(i,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var GameUtil=function(){function t(){}return t.hitTestFruitAir=function(t,e){if(t.isRectangle){for(var r=0,i=t.rectangleArea;r<i.length;r++)for(var n=i[r],a=0,o=GameVar.AirRectangle;a<o.length;a++){var s=o[a],h=new egret.Rectangle(t.x+n.x,t.y+n.y,n.width,n.height),u=new egret.Rectangle(e.x+s.x,e.y+s.y,s.width,s.height);if(h.intersects(u))return!0}return!1}return this.hitTestObjAir(t,e)},t.hitTestObjAir=function(t,e){for(var r=new egret.Rectangle(t.x,t.y,t.width,t.height),i=0,n=GameVar.AirRectangle;i<n.length;i++){var a=n[i],o=new egret.Rectangle(e.x+a.x,e.y+a.y,a.width,a.height);if(r.intersects(o))return!0}return!1},t.hitTestFruitObj=function(t,e){if(t.isRectangle){for(var r=new egret.Rectangle(e.x,e.y,e.width,e.height),i=0,n=t.rectangleArea;i<n.length;i++){var a=n[i],o=new egret.Rectangle(t.x+a.x,t.y+a.y,a.width,a.height);if(o.intersects(r))return!0}return!1}return this.hitTest(t,e)},t.hitTest=function(t,e){var r=new egret.Rectangle(t.x,t.y,t.width,t.height),i=new egret.Rectangle(e.x,e.y,e.width,e.height);return r.intersects(i)},t}();__reflect(GameUtil.prototype,"GameUtil");var GameVar=function(){function t(){}return t.changeSpeed=function(t){t>3&&(this.FruitBirthSpeed=2),t>10&&(this.FruitBirthSpeed=1)},t.stageWidth=750,t.stageHeight=1334,t.bulletWidth=29,t.bulletHeight=47,t.FruitDownSpeed=[0,.1,.12,.14],t.FruitWidth=[0,80,80,80],t.FruitHP=[0,1,5,10],t.FruitScore=[0,1e3,6e3,3e4],t.FruitRectangle=[!1,!1,!0,!1],t.FruitRectangleArray=[[],[],[new myRectangle(1,20,46,57),new myRectangle(32,1,47,62)],[]],t.AirRectangle=[new myRectangle(60,18,42,34),new myRectangle(14,50,134,68)],t.FireDelay=100,t.BulletSpeed=.5,t.BulletBirthSpeed=150,t.FruitBirthSpeed=1500,t.BgDownSpeed=.1,t.BigScore=5,t.SmallScore=1,t}();__reflect(GameVar.prototype,"GameVar");